%% ========== æµç¨‹å›¾ ==========
flowchart TD
    %% å¤–éƒ¨è°ƒç”¨
    subgraph ext["å¤–éƒ¨è°ƒç”¨æ–¹ (Web/App)"]
        A["ç”¨æˆ·/å®¢æˆ·ç«¯"]
        A -- â‘ åˆ›å»º --> restCreate["/grid/create"]
        A -- â‘¡æ›´æ–° --> restUpdate["/grid/update"]
        A -- â‘¢åˆ é™¤ --> restDelete["/grid/delete"]
        A -- â‘£æŸ¥è¯¢ --> restList["/grid/list"]
    end

    %% åº”ç”¨å±‚
    subgraph app["é¡¹ç›®åº”ç”¨å±‚ (ppll-server)"]
        B["REST API Routes<br>GridStrategyRoute"]
        C["GridStrategyController"]
        D["GridStrategyService"]
        E["GridStrategyModel"]

        %% ğŸ†• å…±äº«è¿æ¥æ± 
        F["WebSocketConnectionManager<br>(Spot/UM/CM å…±äº«è¿æ¥æ± )"]

        %% ğŸ†• æ‰§è¡Œå¼•æ“
        G["InfiniteGrid(StrategyExecutor)<br>å¯é€šè¿‡Worker Poolä¼˜åŒ–æ€§èƒ½"]

        %% ğŸ†• æŒ‰äº§å“ç±»å‹æ‹†åˆ†çš„è®¢å•å¤„ç†å™¨
        H_S["OrderHandler<br>(Spot)"]
        H_U["OrderHandler<br>(UM)"]
        H_C["OrderHandler<br>(CM)"]
    end

    %% Start æˆ–è€… Restart
    subgraph ServerRestart["æœåŠ¡å¯åŠ¨æˆ–é‡å¯æ—¶æ¢å¤ç­–ç•¥"]
        I["App.js"]
    end

    %% Binance SDK
    subgraph BinanceClient["Binance ä¾èµ– (npm binance)"]
        J["Binance REST Client"]
        K["Binance WebSocket Client"]
    end

    %% Binance SDK äº¤æ˜“ç»“æœå†³å®šæ•°æ®å‚¨å­˜æµè¡Œ
    J --å¯¹ä»“ä½æ“ä½œ(ä¸‹å•/å¹³å•)æˆåŠŸ--> E

    %% å­˜å‚¨
    subgraph DB["æ•°æ®åº“MySQL"]
        L_A["ç½‘æ ¼ç­–ç•¥çŠ¶æ€è¡¨"]
        L_B["ç½‘æ ¼ç­–ç•¥è®¢å•è®°å½•"]
    end

    %% REST æ¥å…¥
    restCreate --> B
    restUpdate --> B
    restDelete --> B
    restList   --> B
    B --> C
    C --> D
    D <-->|è·å–æˆ–æ“ä½œæ•°æ®åº“æ•°æ®| E
    E <---> DB

    %% å¯åŠ¨æ¢å¤
    ServerRestart -->|åŠ è½½æ‰€æœ‰ç”¨æˆ·çš„æ‰€æœ‰ç­–ç•¥æ•°æ®| D

    %% WS è¿æ¥ç®¡ç†
    F -- wsClient.subscribeè®¢é˜… --> K
    K -- Kçº¿æ•°æ®(tick) --> G

    %% ç­–ç•¥æ‰§è¡Œ
    D -- å¯åŠ¨/åœæ­¢/æ›´æ–° --> F
    G -- ä¸‹å• --> H_S
    G -- ä¸‹å• --> H_U
    G -- ä¸‹å• --> H_C

    %% è®¢å•å¤„ç†
    H_S ---> J
    H_U ---> J
    H_C ---> J

    %% ğŸ†• å®æ—¶è½åº“
    %% G -- å®æ—¶çŠ¶æ€ --> E
    %% H_S -- æˆäº¤/å§”æ‰˜ --> E
    %% H_U -- æˆäº¤/å§”æ‰˜ --> E
    %% H_C -- æˆäº¤/å§”æ‰˜ --> E

    %% æ ·å¼
    style F fill:#f9f,stroke:#333,stroke-width:2px
    style G fill:#ccf,stroke:#333,stroke-width:2px
    style I fill:#f96,stroke:#333,stroke-width:2px